<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/css/syntax.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/main.css">
  <!-- // <script src="http://syssgx.github.io/xml.js/js/xmllint.js"></script> -->
  <!-- // <script src="/scripts/bootstrap.min.js"></script> -->
  	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script>window.jQuery || document.write('<script src="/scripts/jquery.min.js"><\/script>')</script>
	<script src="/scripts/bootstrap.min.js"></script>
<!--<script src="scripts/codemirror.js"></script>-->
    <!--<script src="scripts/searchcursor.js"></script>-->
    <!--<script src="scripts/match-highlighter.js"></script>-->
    <!--<script src="scripts/xml.js"></script>-->
	<!--<script src="scripts/prettify.js"></script>-->
	<!-- <script src="/scripts/xmllint.js"></script> -->
	<!-- // <script src="/scripts/script.js"></script> -->

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-286386-31', 'auto');
    ga('send', 'pageview');
  </script>
  <title>Cadena original para documento de retenciones</title>
</head>

<body class="page-content page-columns-2">
  <a name="top" id="top"></a>
<div id="header-bg">
  <div id="bg-top"><div id="bg-top-left"></div></div>
  <div id="bg-fix"></div>
</div>
<div class="container" id="header">
  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <a id="logo" class="brand icon-logo-off" href="http://diverza.com"></a>
        <div class="nav-collapse">

          <ul class="menu nav">
            <li class="item-101">
              <a href="">Portada</a>
            </li>
            <li class="item-102">
              <a href="http://www.diverza.com/historia" >Historia</a>
            </li>
            <li class="item-103 parent">
              <a href="http://www.diverza.com/oficinas" >Oficinas</a>
            </li>
            <li class="item-104">
              <a href="http://blog.diverza.com" >Blog</a>
            </li>
            <li class="item-105">
              <a href="http://desarrolladores.diverza.com" id="stamp-navitem-selected">Ecosistema</a>
            </li>
            <li class="item-106">
              <a href="http://www.diverza.com/soporte" >Soporte</a>
            </li>
            <li class="item-107">
            <a href="http://www.diverza.com/acceso" >Acceso</a>
            </li>
            <li id="colors-bar">
              <div class="color-bar color-bar-blue"></div>
              <div class="color-bar color-bar-yellow"></div>
              <div class="color-bar color-bar-green"></div>
              <div class="color-bar color-bar-red"></div>
            </li></ul>
          </div>
          <div class="nav-social">
            <ul class="menu-social">
              <li class="item-131"><a class="rss" href="http://feeds.feedburner.com/blog-diverza">RSS</a></li><li class="item-130"><a class="googleplus" href="https://plus.google.com/u/0/100935627964150268592/posts">Google Plus</a></li><li class="item-129"><a class="youtube" href="http://www.youtube.com/user/DiverzaTv?feature=mhee">YouTube</a></li><li class="item-128"><a class="facebook" href="http://www.facebook.com/pages/Diverza/350358341644324">Facebook</a></li><li class="item-127"><a class="twitter" href="http://twitter.com/diverza">Twitter</a></li></ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container" id="header-brand-dummy"></div>
    <div id="header-brand">
      <div class="navbar container">
        <div class="navbar-inner">
          <div class="container">
            <div class="row">

              <div class="span2 nav-welcome ">
                <a href="/"><span class="welcome">desarrolladores<span class="diverza-dot">.</span></span></a>
              </div>

              <div class="nav-collapse-brand" id="menu-sub">
                <ul class="menu nav">
                  <li class="item-102" id="stamp-menu-item">
                    <a href="/timbre/">Timbre Fiscal</a>
                  </li>
                  <li class="item-103" id="conector-menu-item">
                    <a href="/conector/">Conector Fiscal</a>
                  </li>
                  <li class="item-104">
                    <a href="https://groups.google.com/forum/#!forum/diverza" target="_blank">Grupos</a>
                  </li>
                  <li class="item-105">
                    <a href="https://github.com/diverza/desarrolladores" target="_blank">Github</a>
                  </li>
                </ul>
              </div>
              <div class="nav-account">
                <div class="module">
                  <div class="custom">01.800.070.4000</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <style>
  #stamp-menu-item { color: #fff !important;
    background: #ddd;
    -webkit-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -moz-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -o-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -ms-box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    box-shadow: inset 2px 2px 2px rgba(0, 0, 0, 0.25);
    -webkit-border-radius: 20px;
    -moz-border-radius: 20px;
    -o-border-radius: 20px;
    -ms-border-radius: 20px;
    border-radius: 20px;
    text-shadow: 1px 1px rgba(0, 0, 0, 0.20);
    height: 35px;
    margin-top: 2px;
  }
</style>

<div id="body">
  <div class="container">
    <div id="main" class="row">
      <div id="content" class="span12">
        <div id="system-message-container">
        </div>
        <div id="component">
          <div class="item-pagepage-history">
            <div class="clr"></div>
            <div class="article-content-text">
              <h1>Cadena original para documento de retenciones<span class="diverza-dot">.</span></h1>
              <span class="h1-line"></span>
              <div class="clr">&nbsp;</div>
              <p>La cadena original es la secuencia de datos formada con parte de la información contenida dentro del comprobante fiscal digital.</p>

<p>Con la cadena original y tu <a href="/timbre/cfd/certificado.html">certificado</a>, podrás generar el <a href="/timbre/cfd/sello.html">sello</a> que también debes colocar en el comprobante.</p>

<p>Para generarla puedes utilizar un transformador xslt o construirla manualmente.</p>

<h2 id="construcción-automática-con-xslt">Construcción automática con xslt</h2>

<p>Para la construcción de la cadena original automática, necesitas:</p>

<ul>
<li>El <a href="/timbre/cfd/retencion.html">documento de retención</a> con toda la información (<a href="/timbre/resources/RET/cfd_ret_ejemplo.xml">ejemplo</a>)</li>
<li>El <a href="/timbre/resources/RET/retenciones.xslt">xslt</a> de transformación</li>
<li>Instalar la herramienta <a href="http://xmlsoft.org/XSLT/xsltproc2.html">xsltproc</a> (Incluida en Linux y OS X. Para windows descargarla <a href="http://www.zlatkovic.com/libxml.en.html">aquí</a>).</li>
</ul>

<p>Desde la linea de comando deberás ejecutar:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&gt;xsltproc retenciones.xslt cfd_ret_ejemplo.xml
</code></pre></div>
<p>Recibirás la cadena original:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">||1.0|20001000000100005867|TEST00001|2015-01-05T10:12:48-06:00|25|Otro tipo de retención|AAA010101AAA|Empresa DEMO para Rentenciones S de TST|AAAA010101HNLMNLD2|Nacional|XAXX010101000|PÚBLICO EN GENERAL S DE TST|VAHE820926HNLLRD02|6|6|2014|14000.00|13000.00|1000.00|3500.00|1000.00|01|500.00|Pago definitivo|1000.00|02|500.00|Pago provisional||~
</code></pre></div>
<hr>

<h2 id="construcción-manual">Construcción manual</h2>

<p>Si deseas construirla manualmente, estas son las reglas generales:</p>

<ol>
<li> Ninguno de los atributos que conforman al comprobante fiscal digital deberá contener el caracter | (“pipe”) debido a que este será utilizado como caracter de control en la formación de la cadena original.</li>
<li> El inicio de la cadena original se encuentra marcado mediante una secuencia de caracteres || (doble “pipe”).</li>
<li> Se expresará únicamente la información del dato sin expresar el atributo al que hace referencia. Esto es, si la serie del comprobante es la “A” solo se expresará |A| y nunca |Serie A|.</li>
<li> Cada dato individual se encontrará separado de su dato subsiguiente, en caso de existir, mediante un carácter | (“pipe” sencillo).</li>
<li> Los espacios en blanco que se presenten dentro de la cadena original serán tratados de la siguiente manera:

<ul>
<li>Se deberán remplazar todos los tabuladores, retornos de carro y saltos de línea por espacios en blanco.</li>
<li>Acto seguido se elimina cualquier caracter en blanco al principio y al final de cada separador | (“pipe” sencillo).</li>
<li>Finalmente, toda secuencia de caracteres en blanco intermedias se sustituyen por un único caracter en blanco.</li>
</ul></li>
<li> Los datos opcionales no expresados, no aparecerán en la cadena original y no tendrán delimitador alguno.</li>
<li> El final de la cadena original será expresado mediante una cadena de caracteres || (doble “pipe”).</li>
<li> Toda la cadena original se expresará en el formato de codificación UTF-8.</li>
<li> El nodo o nodos adicionales <ComplementoConcepto> se integrarán a la cadena original como se indica en la secuencia de formación en su numeral 10, respetando la secuencia de formación y número de orden del ComplemetoConcepto.</li>
<li>El nodo o nodos adicionales <Complemento> se integraran al final de la cadena original respetando la secuencia de formación para cada complemento y número de orden del Complemento.</li>
</ol>

<h3 id="secuencia-de-formación">Secuencia de formación</h3>

<p>La secuencia de formación será siempre en el orden que se expresa a continuación, tomando en cuenta las reglas generales expresadas en el párrafo anterior.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">**||version|fecha|tipoDeComprobante|formaDePago|condicionesDePago|subTotal|descuento|TipoCambio|Moneda|total|metodoDePago|LugarExpedicion|NumCtaPago|FolioFiscalOrig|SerieFolioFiscalOrig|FechaFolioFiscalOrig|MontoFolioFiscalOrig|Emisor:rfc|Emisor:nombre|Emisor:DomicilioFiscal:calle|Emisor:DomicilioFiscal:noExterior|Emisor:DomicilioFiscal:noInterior|Emisor:DomicilioFiscal:colonia|Emisor:DomicilioFiscal:localidad|Emisor:DomicilioFiscal:referencia|Emisor:DomicilioFiscal:municipio|Emisor:DomicilioFiscal:estado|Emisor:DomicilioFiscal:referencia|Emisor:DomicilioFiscal:estado|Emisor:DomicilioFiscal:pais|Emisor:DomicilioFiscal:codigoPostal|Emisor:ExpedidoEn:calle|Emisor:ExpedidoEn:noExterior|Emisor:ExpedidoEn:noInterior|Emisor:ExpedidoEn:colonia|Emisor:ExpedidoEn:localidad|Emisor:ExpedidoEn:referencia|Emisor:ExpedidoEn:municipio|Emisor:ExpedidoEn:estado|Emisor:ExpedidoEn:referencia|Emisor:ExpedidoEn:estado|Emisor:ExpedidoEn:pais|Emisor:ExpedidoEn:codigoPostal|Emisor:RegimenFiscal:Regimen|Receptor:rfc|Receptor:nombre|Receptor:DomicilioFiscal:calle|Receptor:DomicilioFiscal:noExterior|Receptor:DomicilioFiscal:noInterior|Receptor:DomicilioFiscal:colonia|Receptor:DomicilioFiscal:localidad|Receptor:DomicilioFiscal:referencia|Receptor:DomicilioFiscal:municipio|Receptor:DomicilioFiscal:estado|Receptor:DomicilioFiscal:referencia|Receptor:DomicilioFiscal:estado|Receptor:DomicilioFiscal:pais|Receptor:DomicilioFiscal:codigoPostal|Concepto:cantidad|Concepto:unidad|Concepto:noIdentificacion|Concepto:descripcion|Concepto:valorUnitario|Concepto:importe|Concepto:InformacionAduanera:numero|Concepto:InformacionAduanera:fecha|Concepto:InformacionAduanera:aduana|Concepto:CuentaPredial:numero|ComplementoConcepto|Impuestos:Retencion:impuesto|Impuestos:Retencion:importe|Impuestos:totalImpuestosRetenidos|Impuestos:Traslado:impuesto|Impuestos:Traslado:importe|Impuestos:totalImpuestosTrasladados||
</code></pre></div>
<p>* Los campos no obligatorios en la definición del CFDI, se podrían ignorar en la cadena. Como <strong>Emisor:ExpedidoEn</strong> <strong>Receptor:ExpedidoEn</strong></p>

<p>* Para cada uno de los nodos de <strong>Emisor:RegimenFiscal</strong>, se deberá incluir cada valor <em>Regimen</em></p>

<p>* Para cada uno de los nodos de <strong>Concepto:InformacionAduanera</strong> deberá incluir cada valor <em>numero</em>, <em>fecha</em>, <em>aduana</em></p>

<p>* Para todos los nodos de <strong>Impuestos:Trasladado</strong> y <strong>Impuestos:Retencion</strong> <em>impuesto</em>, <em>importe</em></p>

<p>Puedes consultar el detalle en el <a href="/timbre/resources/Anexo20_cfdiv32_30122011.pdf">Anexo 20</a>, página 48</p>

            </div>
          </div>
        </div>
      </div>
      <div id="sidebar-right" class="span3 sidebar">
    <div class="sidebar-padding">
        <div class=" ">
            <div class="module">

                <h3>CFDI<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/timbre/cfd">Datos del CFDi</a></li>
                        <li class="item-178"><a href="/timbre/cfd/complementos/">Complementos del CFDi</a></li>
                        <li class="item-178"><a href="/timbre/cfd/retencion.html">CFDi de retenciones</a></li>
                    </ul>
                </div>

                <h3>Sello<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/timbre/cfd/cadena.html">La cadena original</a></li>
                        <li class="item-178"><a href="/timbre/cfd/cadena-retenciones.html">La cadena original para el documento de retenciones</a></li>
                        <li class="item-178"><a href="/timbre/cfd/certificado.html">Los datos del certificado</a></li>
                        <li class="item-178"><a href="/timbre/cfd/sello.html">El sello digital</a></li>
                    </ul>               
                </div>

                <br />
                <h3>Servicio<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/timbre/endpoints.html">Endpoints</a></li>
                        <li class="item-178"><a href="/timbre/refid.html">RefID</a></li>
                        <li class="item-178"><a href="/timbre/codigos">Códigos de respuesta</a></li>
                    </ul>
                </div>

                <h3>Cancelación<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/timbre/cancelacion/">Servicio</a></li>
                        <li class="item-178"><a href="/timbre/cancelacion/respuesta_cancelacion.html">Códigos de respuesta</a></li>
                    </ul>               
                </div>

                <br />
                <h3>Ejemplos<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/timbre/c-sharp">C# .NET</a></li>
                        <li class="item-178"><a href="/timbre/c-c++">C / C++</a></li>
                        <li class="item-178"><a href="/timbre/elixir-erlang">Elixir / Erlang</a></li>
                        <li class="item-178"><a href="/timbre/go">Go</a></li>
                        <li class="item-178"><a href="/timbre/java">Java</a></li>
                        <li class="item-178"><a href="/timbre/php">PHP</a></li>
                        <li class="item-178"><a href="/timbre/perl">Perl</a></li>
                        <li class="item-178"><a href="/timbre/python">Python</a></li>
                        <li class="item-178"><a href="/timbre/ruby">Ruby</a></li>
                        <li class="item-178"><a href="/timbre/terminal">Terminal</a></li>
                        <li class="item-178"><a href="/timbre/visual-basic-6">Visual Basic 6</a></li>
                    </ul>               
                </div>

                <!-- <br />
                <h3>herramientas<span class="diverza-dot">.</span></h3>
                <span class="h3-line"></span>
                <div class="clr"></div>

                <div class="module-content">
                    <ul class="menu">
                        <li class="item-178"><a href="/oficinas/aguascalientes">Prueba el Servicio</a></li>
                        <li class="item-178"><a href="/stamp/validate">Valida CFD</a></li>
                    </ul>               
                </div> -->
            </div>
            <div class="clr"></div>
        </div>
    </div>
</div>
    </div>
  </div>
</div>
  <style>
    .hero-unit { }
    #body { background: #fff url('/images/content-dev.png') no-repeat 50% 0 ; }
  </style>

  <div id="footer">
	<div class="container">
		<footer>

			<ul class="menu">
				<li class="item-123"><a href="http://www.diverza.com/privacidad">Aviso de privacidad</a></li><li class="item-124"><a href="http://www.diverza.com/terminos">Términos y condiciones</a></li><li class="item-125"><a href="http://www.diverza.com/integrate">Intégrate al equipo</a></li><li class="item-135"><a href="http://www.diverza.com/mi-cuenta">Mi cuenta</a></li></ul>

				<div class="custom">

					<div class="row-fluid">
						<br>
						<div class="span3"></div>

						<div class="span2" style="margin:0px"><a href="http://www.greatplacetowork.com.mx" title="GPTW" class="footer-logo-gptw" style="margin: -20px 0 0 auto;" target="_blank">GPTW</a></div>

						<div class="span2" style="margin:0 6px 0 20px;"><a href="http://www.sat.gob.mx/sitio_internet/asistencia_contribuyente/principiantes/comprobantes_fiscales/66_20006.html" title="SAT" class="footer-logo-sat" style="margin: -20px auto 0 auto;" target="_blank">SAT</a></div>

						<div class="span2" style="margin:0px"><a href="http://www.amexipac.org.mx" title="AMEXIPAC" class="footer-logo-amexipac" style="margin: -20px auto 0 0;" target="_blank">AMEXIPAC</a></div>

						<div class="span2"></div>

						<div class="clr"></div>

						<div style="font-size:10px; margin-top: 5px;">DIVERZA © Copyright.&nbsp;Los nombres y logos de Buzón Fiscal®, Conector Fiscal® y Timbre Fiscal® son marcas registradas de Diverza Información y Análisis, SAPI de CV. Otros nombres y logos son marcas registradas de sus respectivos propietarios. Todo el contenido de este sitio y los documentos para descarga son propiedad intelectual de Diverza Información y Análisis, SAPI de CV.<br> 

							<div class="clr"></div>
							<div style="font-size:12px;margin-top: 5px;text-align: center;">

								<script type="text/javascript">
									<!--
									var prefix = '&#109;a' + 'i&#108;' + '&#116;o';
									var path = 'hr' + 'ef' + '=';
									var addy64856 = 'c&#111;nt&#97;ct&#111;' + '&#64;';
									addy64856 = addy64856 + 'd&#105;v&#101;rz&#97;' + '&#46;' + 'c&#111;m';
									document.write('<a ' + path + '\'' + prefix + ':' + addy64856 + '\'>');
									document.write(addy64856);
									document.write('<\/a>');
									//-->\n </script>
									<span style="display: none;">This email address is being protected from spambots. You need JavaScript enabled to view it.
<script type="text/javascript">
	<!--
	document.write('</');
	document.write('span>');
 //-->
</script></span> &nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp;<a href="https://www.diverza.com/servicio-gratuito">acceso al servicio gratuito</a> &nbsp;&nbsp;&nbsp;| &nbsp;&nbsp;&nbsp; 01.800.070.4000</div></div>
</div></div>

</footer>
</div>
</div>
</body>
</html>